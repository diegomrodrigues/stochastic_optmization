## Capítulo 2: Problemas de Dois Estágios (Continuação)

### Seção 2.1.3: O Custo Esperado de Recurso para Distribuições Gerais (Continuação)

#### Condições para a Boa Definição do Custo Esperado de Recurso

### Introdução

Como introduzido anteriormente (Seção 2.1.2 para distribuições discretas e início da Seção 2.1.3 para distribuições gerais), o custo esperado de recurso, denotado por $\\phi(x) := E[Q(x, \\xi)]$ [^13], desempenha um papel central na formulação e análise de problemas de programação estocástica linear de dois estágios (2.1) [^14]. A análise subsequente, incluindo otimização e propriedades de $\\phi(x)$, depende crucialmente de garantir que esta expectativa esteja bem definida, especialmente quando o vetor aleatório $\\xi$ segue uma distribuição de probabilidade geral, potencialmente contínua. Expandindo a discussão iniciada na Seção 2.1.3, este segmento aprofunda as condições necessárias para a boa definição de $E[Q(x, \\xi)]$.

> Recorde que, para assegurar que a expectativa $\\phi(x)$ esteja bem definida, temos que verificar duas condições [^1]:
> (i) $Q(x, \\cdot)$ é mensurável (com respeito à sigma-álgebra de Borel de $R^d$);
> (ii) ou $E[Q(x, \\xi)+]$ ou $E[(-Q(x, \\xi))+]$ é finita.

Aqui, $Q(x, \\xi)+ = \\max\\{Q(x, \\xi), 0\\}$ e $(-Q(x, \\xi))+ = \\max\\{-Q(x, \\xi), 0\\}$ representam as partes positivas de $Q(x, \\xi)$ e $-Q(x, \\xi)$, respectivamente. A necessidade da condição (ii) advém da possibilidade de a expectativa envolver termos como $+\\infty$ e $-\\infty$, o que tornaria o valor esperado indefinido.

### Conceitos Fundamentais: Verificação das Condições

**Mensurabilidade de Q(x, ·)**

A primeira condição, a mensurabilidade da função de custo de recurso $Q(x, \\cdot)$ em relação à sigma-álgebra de Borel apropriada no espaço das realizações de $\\xi$, é um requisito padrão da teoria da medida para que a integral de Lebesgue (expectativa) seja definida. Felizmente, no contexto de problemas lineares de dois estágios, esta condição é geralmente satisfeita. Como $Q(x, \\xi)$ é o valor ótimo do problema de programação linear de segundo estágio (2.2) [^2], pode-se demonstrar que $Q(x, \\cdot)$ é uma função *random lower semi-continuous* [^1]. Especificamente, para cada $x$ fixo, $Q(x, \\cdot)$ é mensurável com respeito à sigma-álgebra de Borel de $R^d$, onde $d$ é a dimensão do vetor aleatório $\\xi$ [^1]. Portanto, a condição (i) é satisfeita [^1].

**Finitude da Expectativa das Partes Positiva ou Negativa**

A condição crucial a ser verificada é a (ii): a finitude da expectativa da parte positiva ou da parte negativa de $Q(x, \\xi)$. Esta condição garante que a expectativa não assuma a forma indeterminada $\\infty - \\infty$. A análise desta condição no texto [^1] foca em situações particulares importantes, notavelmente o caso de **fixed recourse**.

Lembremos que um problema de dois estágios tem **fixed recourse** se a matriz tecnológica do segundo estágio, $W$, é determinística (não aleatória) [^3]. Sob esta suposição e condições adicionais sobre os momentos das componentes aleatórias, podemos estabelecer condições necessárias e suficientes para a finitude de $E[Q(x, \\xi)+]$.

**Proposição 2.6.** Suponha que o recurso seja *fixed* (W é determinístico) e que as seguintes condições de momento finito sejam satisfeitas [^4]:
$$ E[||q|| ||h||] < +\\infty \\quad \\text{e} \\quad E[||q|| ||T||] < +\\infty. \\quad (2.28) $$
Considere um ponto $x \\in R^n$. Então $E[Q(x, \\xi)+]$ é finita *se e somente se* a seguinte condição é válida com probabilidade 1 (w.p. 1) [^4]:
$$ h - Tx \\in \\text{pos W}. \\quad (2.29) $$

*Esboço da Prova:* A necessidade (direção $\\Rightarrow$) é direta: se a condição (2.29) falha com probabilidade positiva, então $Q(x, \\xi) = +\\infty$ (por definição, quando o problema (2.2) é infactível [^15]) com probabilidade positiva, implicando $E[Q(x, \\xi)+] = +\\infty$ [^4]. Para a suficiência ($\\Leftarrow$), assume-se que (2.29) vale w.p. 1. Então, $Q(x, \\xi) = s_q(h - Tx)$ w.p. 1, onde $s_q(\\cdot)$ é a *support function* do conjunto $\\Pi(q) = \\{\\pi : W^T\\pi \\le q\\}$ [^16]. Usando a desigualdade (2.26), derivada do Lema de Hoffman [^5], que fornece $s_q(z) \\le s_0(z) + \\kappa ||q|| ||z||$ para alguma constante $\\kappa$ (dependendo de W), e notando que $s_0(z) = 0$ para $z \\in \\text{pos W}$ [^5], temos $Q(x, \\xi) = s_q(h - Tx) \\le \\kappa ||q|| ||h - Tx||$ w.p. 1. Aplicando a desigualdade triangular e a norma, $Q(x, \\xi) \\le \\kappa ||q|| (||h|| + ||T|| ||x||)$ w.p. 1. Tomando a parte positiva e a expectativa, $E[Q(x, \\xi)+] \\le \\kappa E[||q|| (||h|| + ||T|| ||x||)] = \\kappa (E[||q|| ||h||] + ||x|| E[||q|| ||T||])$. Sob a condição (2.28), o lado direito é finito, provando a suficiência [^4]. $\\blacksquare$

A condição (2.28) é satisfeita, por exemplo, se $q$ e $(h, T)$ são independentes e possuem primeiros momentos finitos, ou se o vetor $(h, T, q)$ possui segundos momentos finitos [^6].

Esta proposição estabelece que, sob *fixed recourse* e condições de momento finito (2.28), a finitude da parte positiva da expectativa $E[Q(x, \\xi)+]$ está diretamente ligada à factibilidade do problema de segundo estágio com probabilidade 1, expressa pela condição (2.29) [^7].

A condição (2.29) mantida w.p. 1 para um dado $x$ está intimamente relacionada ao conceito de **relatively complete recourse**. Diz-se que o recurso é *relatively complete* se para todo $x$ no conjunto factível do primeiro estágio $X = \\{x: Ax = b, x \\ge 0\\}$, o problema de segundo estágio (2.2) é factível quase certamente (a.e.), ou seja, $Q(x, \\xi) < +\\infty$ w.p. 1 [^8]. No caso de *fixed recourse*, a condição (2.24), que exige $Q(x, \\xi) < +\\infty$ para *todo* $\\xi$ no suporte $\\Xi$, torna-se necessária e suficiente para *relatively complete recourse* [^9]. A importância do *fixed recourse* é destacada pelo Exemplo 2.5, que ilustra instabilidade e má-posição do problema quando o recurso não é fixo e a infactibilidade ocorre num conjunto de medida zero dentro do suporte [^10].

Construindo sobre a Proposição 2.6, a Proposição 2.7 estabelece condições para que $\\phi(x)$ seja bem definida e possua propriedades desejáveis.

**Proposição 2.7.** Suponha que (i) o recurso seja *fixed*, (ii) para quase todo $q$, o conjunto dual factível $\\Pi(q)$ seja não-vazio, e (iii) a condição (2.28) seja válida. Então a função de expectância $\\phi(x)$ é bem definida e $\\phi(x) > -\\infty$ para todo $x \\in R^n$. Além disso, $\\phi$ é convexa, semicontínua inferiormente (*lower semicontinuous*) e Lipschitz contínua em seu domínio, $dom~\\phi$, que é um subconjunto convexo e fechado de $R^n$ dado por [^11]:
$$ dom~\\phi = \\{x \\in R^n : h - Tx \\in \\text{pos W} \\text{ w.p. } 1\\}. \\quad (2.30) $$

*Esboço da Prova:* A condição (ii) garante que $Q(x, \\xi) = s_q(h - Tx)$ w.p. 1 sempre que $h - Tx \\in \\text{pos W}$ [^11]. A condição $\\phi(x) > -\\infty$ decorre da desigualdade (2.31): $s_q(h - Tx) \\ge \\pi(q)^T(h - Tx) \\ge -\\kappa ||q|| (||h|| + ||T|| ||x||)$ w.p. 1, onde $\\pi(q)$ é o elemento de norma mínima em $\\Pi(q)$ [^12]. Tomando a expectativa e usando (2.28), obtemos $\\phi(x) \\ge -\\kappa (E[||q|| ||h||] + ||x|| E[||q|| ||T||]) > -\\infty$ [^12]. A convexidade e a semicontinuidade inferior de $\\phi$ seguem da convexidade e LSC de $Q(\\cdot, \\xi)$ e do Lema de Fatou [^12]. A finitude $\\phi(x) < +\\infty$ é garantida pela Proposição 2.6 precisamente quando $x \\in dom~\\phi$ como definido em (2.30) [^12]. A propriedade de Lipschitz segue da desigualdade (2.27), $|s_q(z_1) - s_q(z_2)| \\le \\kappa ||q|| ||z_1 - z_2||$, aplicada a $z_1 = h - Tx$ e $z_2 = h - Tx\'$, levando a $|\\phi(x) - \\phi(x\')| \\le \\kappa E[||q|| ||T||] ||x - x\'||$ para $x, x\' \\in dom~\\phi$ [^17]. A natureza convexa e fechada de $dom~\\phi$ pode ser vista a partir da forma (2.33), que o expressa como a interseção sobre o suporte $\\Sigma$ de $(h, T)$ dos conjuntos convexos e fechados $\\{x : h - Tx \\in \\text{pos W}\\}$ [^18]. $\\blacksquare$

Estas proposições fornecem uma base sólida para a análise de $\\phi(x)$ no caso de *fixed recourse*, garantindo que a expectativa esteja bem definida e exibindo propriedades importantes sob condições relativamente suaves sobre os momentos das variáveis aleatórias.

### Conclusão

A boa definição da função de custo esperado de recurso $E[Q(x, \\xi)]$ é um pré-requisito fundamental para a análise e solução de problemas de programação estocástica de dois estágios com distribuições gerais ou contínuas. Vimos que a mensurabilidade de $Q(x, \\cdot)$ é inerente à sua natureza como valor ótimo de um problema de programação linear. A condição crítica reside na finitude da expectativa da parte positiva ou negativa de $Q(x, \\xi)$.

No importante caso de **fixed recourse**, as Proposições 2.6 e 2.7 estabelecem que, sob condições de momentos finitos (2.28), a boa definição e finitude de $\\phi(x)$ estão ligadas à factibilidade quase certa do problema de segundo estágio (condição 2.29), que define o domínio efetivo da função de custo esperado (2.30). Além disso, garantem que $\\phi(x)$ seja bem comportada (convexa, LSC, Lipschitz contínua em seu domínio) quando o conjunto dual factível é não-vazio w.p. 1. Estas condições são essenciais para justificar as operações subsequentes de otimização e análise de sensibilidade, como as condições de otimalidade exploradas nas Seções 2.1.4, 2.2.3 e 2.3.

### Referências

[^1]: Página 33: "Recall that in order to ensure that the expectation φ(x) is well defined, we have to verify two conditions: (i) Q(x, ·) is measurable (with respect to the Borel sigma algebra of Rd); (ii) either E[Q(x, ξ)+] or E[(-Q(x, ξ))+] is finite. The function Q(x, ·) is measurable as the optimal value of a linear programming problem. We only need to verify condition (ii). ... It follows that Q(x, ξ) is a random lower semicontinuous function."
[^2]: Página 27: "where Q(x, ξ) is the optimal value of the second-stage problem Min qT y s.t. Tx + Wy = h, y ≥ 0. (2.2)"
[^3]: Página 33: "The two-stage problem (2.1)–(2.2) is said to have fixed recourse if the matrix W is fixed (not random)."
[^4]: Página 35: "Proposition 2.6. Suppose that the recourse is fixed and E[||q|| ||h||] < +∞ and E[||q|| ||T||] < +∞. (2.28) Consider a point x ∈ R^n. Then E[Q(x, ξ)+] is finite iff the following condition holds w.p. 1: h - Tx ∈ pos W. (2.29) Proof. We have that Q(x, ξ) < +∞ iff condition (2.29) holds. Therefore, if condition (2.29) does not hold w.p. 1, then Q(x, ξ) = +∞ with positive probability, and hence E[Q(x, ξ)+] = +∞. Conversely, suppose that condition (2.29) holds w.p. 1. Then Q(x, ξ) = sq(h – Tx) ... By (2.26) there exists a constant κ such that ... sq(h – Tx) ≤ κ||q|| ||h - Tx|| ≤ κ||q||(||h|| + ||T|| ||x||). It follows then by (2.28) that E [sq(h – Tx)+] < +∞. Π"
[^5]: Página 34: "By Hoffman\'s lemma (Theorem 7.11), there exists a constant κ, ... Π(q) ⊂ Π(q0) + κ ||q - q0|| B, (2.25) ... it follows from (2.25) that if the set Π(q0) is nonempty, then sq(·) ≤ sq0(·) + κ ||q - q0 || || · ||. (2.26) Consider q0 = 0. The support function s0(·) of the cone Π0 has the form s0(x) = { 0 if x ∈ pos W, +∞ otherwise. Therefore, (2.26) with q0 = 0 implies that if Π(q) is nonempty, then sq(x) ≤ κ||q|| ||x|| for all x ∈ pos W..."
[^6]: Página 35: "Remark 2. If q and (h, T) are independent and have finite first moments, then E[||q|| ||h||] = E[||q||]E[||h||] and E[||q|| ||T||] = E[||q||]E[||T||], and hence condition (2.28) follows. Also condition (2.28) holds if (h, T, q) has finite second moments."
[^7]: Página 35: "We obtain that, under the assumptions of Proposition 2.6, the expectation φ(x) is well defined and φ(x) < +∞ iff condition (2.29) holds w.p. 1."
[^8]: Página 33: "It is said that the recourse is relatively complete if for every x in the set X = {x: Ax = b, x ≥ 0}, the feasible set of the second-stage problem (2.2) is nonempty for almost everywhere (a.e.) ω ∈ Ω. That is, the recourse is relatively complete if for every feasible first-stage point x the inequality Q(x, ξ) < +∞ holds true for a.e. ξ ∈ Ξ, or in other words, Q(x, ξ(ω)) < +∞ w.p. 1."
[^9]: Página 33: "The following condition is sufficient for relatively complete recourse: for every x ∈ X the inequality Q(x, ξ) < +∞ holds true for all ξ ∈ Ξ. (2.24) In general, condition (2.24) is not necessary for relatively complete recourse. It becomes necessary and sufficient in the following two cases: (i) the random vector ξ has a finite support, or (ii) the recourse is fixed. ... To show the necessity in the case of fixed recourse, suppose the recourse is relatively complete. This means that if x ∈ X, then Q(x, ξ) < +∞ for all ξ in Ξ, except possibly for a subset of Ξ of probability zero. We have that Q(x, ξ) < +∞ iff h - Tx ∈ pos W."
[^10]: Página 34: "Example 2.5. Consider Q(x, ξ) := inf {y : ξy = x, y ≥ 0} ... E[Q(x, ξ)] = ∫(x/z) 2zdz = 2x. ... On the other hand, the support of ξ(ω) is the interval [0, 1], and for ξ = 0 and x > 0 the value of Q(x, §) is +∞... Note, however, that arbitrary small perturbation... may change that. ... Therefore, E[Q(x, ξ)] = +∞ for all x > 0. That is, the above problem is extremely unstable and is not well posed. As discussed above, such behavior cannot occur if the recourse is fixed."
[^11]: Página 35: "Proposition 2.7. Suppose that (i) the recourse is fixed, (ii) for a.e. q the set Π(q) is nonempty, and (iii) condition (2.28) holds. Then the expectation function φ(x) is well defined and φ(x) > −∞ for all x ∈ R^n. Moreover, φ is convex, lower semicontinuous and Lipschitz continuous on dom φ, and its domain is a convex closed subset of R^n given by dom φ = {x ∈ R^n : h − Tx ∈ pos W w.p.1}. (2.30)"
[^12]: Página 36: "Proof. By assumption (ii), the feasible set Π(q) of the dual problem is nonempty w.p. 1. Thus Q(x, ξ) is equal to sq(h – Tx) w.p. 1 for every x... By Hoffman\'s lemma (see (2.25)) there is a constant κ such that ||π(q)|| ≤ κ||q||. Then for every x the following holds w.p. 1: sq(h – Tx) ≥ π(q)T(h – Tx) ≥ −κ||q||(||h|| + ||T|| ||x||). (2.31) Owing to condition (2.28), it follows from (2.31) that φ(·) is well defined and φ(x) > -∞ for all x ∈ R^n. Moreover, since sq(·) is lower semicontinuous, the lower semicontinuity of φ(·) follows by Fatou\'s lemma. Convexity and closedness of dom φ follow from the convexity and lower semicontinuity of φ. We have by Proposition 2.6 that φ(x) < +∞ iff condition (2.29) holds w.p. 1. This implies (2.30)."
[^13]: Página 30: "Let us consider now the expected value function φ(x) := E[Q(x, ξ)]. (2.12)"
[^14]: Página 27: "Min cT x + E[Q(x, ξ)] s.t. Ax = b, x ≥ 0, (2.1)"
[^15]: Página 27: "If for some x and ξ ∈ Ξ the second-stage problem (2.2) is infeasible, then by definition Q(x, ξ) = +∞."
[^16]: Página 28: "Clearly, Q(x, ξ) = sq(h – Tx). By the duality theory of linear programming, if the set Π(q) := {π : W^Tπ ≤ q} (2.5) is nonempty, then sq(x) = sup π^T x, πεΠ(q) (2.6) i.e., sq(·) is the support function of the set Π(q)."
[^17]: Página 36: "By (2.27), if the set Π(q) is nonempty and (2.32) holds, then |sq(h - Tx) - sq(h – Tx\')| ≤ κ||q|| ||T|| ||x − x\'||. It follows that |φ(x) – φ(x\')| ≤ κE[||q|| ||T||] ||x − x\'||. With condition (2.28) this implies the Lipschitz continuity of φ on its domain." (Note: (2.27) is |sq(x1) - sq(x2)| ≤ κ ||q|| ||x1 - x2||)
[^18]: Página 36: "Denote by Σ the support of the probability distribution (measure) of (h, T). Formula (2.30) means that a point x belongs to dom φ iff the probability of the event {h - Tx ∈ pos W} is one. ... Consequently x belongs to dom φ iff for every (h, T) ∈ Σ it follows that h - Tx ∈ pos W. Therefore, we can write formula (2.30) in the form dom φ = ∩ (h,T)∈Σ {x : h − Tx ∈ pos W}. (2.33)"

<!-- END -->